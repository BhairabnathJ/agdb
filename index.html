<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgriScan - Tiered View</title>
    <link rel="stylesheet" href="/css/main.css">
    <script src="/js/physics.js"></script>
    <script src="/js/i18n.js"></script>
    <script src="/js/app.js"></script>

</head>

<body>

    <main class="container">

        <!-- TIER 1: Simple Mode (Default) -->
        <section id="tier-1" class="view-section active">
            <!-- Status Icon -->
            <div class="status-hero">
                <div id="t1-status-icon" class="status-circle-large healthy"></div>
            </div>

            <!-- Primary Message -->
            <h1 id="t1-message" class="hero-title">ALL GOOD</h1>
            <p id="t1-instruction" class="hero-subtitle">No action needed</p>

            <!-- Actions -->
            <div class="hero-actions">
                <button class="btn-primary btn-large" onclick="App.goToTier(2)">Why?</button>
                <button class="btn-secondary btn-large" onclick="App.goToTier(3)">Show Details</button>
            </div>

            <div class="hero-footer">
                <span id="t1-time">Last updated: Just now</span>
                <div style="margin-top:20px;">
                    <!-- Feature #7: Language Selector -->
                    <select id="lang-select-t1"
                        style="font-size:12px; padding:4px; border:1px solid #ccc; border-radius:4px;"
                        onchange="App.setLang(this.value)">
                        <option value="en">English</option>
                        <option value="es">EspaÃ±ol</option>
                    </select>
                </div>
            </div>
        </section>


        <!-- TIER 2: Reasoning Mode -->
        <section id="tier-2" class="view-section">
            <div class="view-header">
                <h2 class="font-h2">Why do I need to water?</h2>
            </div>

            <div class="reasoning-card">
                <ul class="reasoning-list" id="t2-reasons">
                    <!-- JS Populated -->
                </ul>
            </div>

            <div class="action-stack">
                <button class="btn-primary btn-full" onclick="App.goToTier(1)">OK, Got It</button>
                <button class="btn-ghost btn-full" onclick="App.goToTier(3)">Show Technical Details</button>
            </div>
        </section>


        <!-- TIER 3: Expert Mode -->
        <section id="tier-3" class="view-section">
            <div class="view-header">
                <button class="btn-text" onclick="App.goToTier(1)">â€¹ Back to Simple View</button>
            </div>

            <!-- Current Readings Grid (Updated for VWC/Psi) -->
            <div class="metrics-grid-dense">
                <div class="metric-cell healthy" id="t3-moist-cell">
                    <label>VWC</label> <!-- Changed from Moist -->
                    <span id="t3-moist">--%</span>
                </div>
                <div class="metric-cell" id="t3-soil-temp-cell">
                    <label>S.Temp</label>
                    <span id="t3-soil-temp">--Â°C</span>
                </div>
                <div class="metric-cell">
                    <label>Raw ADC</label> <!-- Changed from A.Temp/EC -->
                    <span id="t3-ec">--</span>
                </div>
                <div class="metric-cell">
                    <label>Potentl</label> <!-- Psi -->
                    <span id="t3-vpd">--kPa</span>
                </div>
                <div class="metric-cell">
                    <label>Avail H2O</label> <!-- AW_mm -->
                    <span id="t3-leaf">--mm</span>
                </div>
                <div class="metric-cell">
                    <label>Depletion</label>
                    <span id="t3-depletion">--%</span>
                </div>
            </div>

            <!-- Chart -->
            <div class="chart-wrapper">
                <h3 class="font-h3">VWC History</h3>
                <div class="chart-container" id="tier3-chart">
                    <!-- SVG Chart -->
                </div>
            </div>

            <!-- Admin Simulator (Feat from sch.txt) -->
            <div class="settings-group" style="padding-top:16px; border-top:1px solid #eee;">
                <h3 class="font-h3">Data Simulator</h3>
                <div class="action-grid">
                    <button class="btn-secondary" onclick="App.simulateRain()"
                        style="color:blue; border-color:blue;">Simulate Rain</button>
                    <button class="btn-secondary" onclick="App.simulateDrought()"
                        style="color:orange; border-color:orange;">Simulate Drought</button>
                </div>
                <div class="action-grid" style="margin-top:12px;">
                    <button class="btn-secondary" id="btn-long-run" onclick="App.simulateLongRun()"
                        style="color:#6A1B9A; border-color:#6A1B9A;">10-Min Simulation</button>
                    <button class="btn-secondary" id="btn-stop-sim" onclick="App.stopSimulation()"
                        style="color:#C62828; border-color:#C62828;" disabled>Stop</button>
                </div>
                <div id="sim-countdown" class="sim-countdown" style="display:none;">
                    <span id="sim-phase">--</span> | <span id="sim-time">00:00</span>
                </div>
                <div class="action-grid" style="margin-top:12px;">
                    <button class="btn-secondary" onclick="App.exportSimulationLogs()"
                        style="color:#00695C; border-color:#00695C;">Export Logs (JSON)</button>
                    <button class="btn-secondary" onclick="App.exportAllData()"
                        style="color:#37474F; border-color:#37474F;">Export Full Data</button>
                </div>
            </div>

            <!-- Actions -->
            <div class="action-grid">
                <button class="btn-secondary" onclick="App.goToMap()">View Zone Map</button>
                <button class="btn-secondary" onclick="App.exportCSV()">Download DB</button>
            </div>
            <div class="action-grid" style="margin-top:8px;">
                <button class="btn-secondary" onclick="App.goToSettings()">View Settings</button>
                <button class="btn-secondary" onclick="App.goToDiagnostics()"
                    style="color:#1565C0; border-color:#1565C0;">System Diagnostics</button>
            </div>

        </section>


        <!-- TIER MAP: Zone/Area View -->
        <section id="tier-map" class="view-section">
            <div class="view-header">
                <button class="btn-text" onclick="App.goToTier(3)">â€¹ Back</button>
                <h2 class="font-h2">Field Zones</h2>
            </div>

            <div class="zone-legend">
                <p style="font-size:14px; color:var(--neutral-600); margin-bottom:16px;">
                    Select a zone to view detailed sensor data. Gray zones have no sensor.
                </p>
                <div class="legend-items">
                    <div class="legend-item">
                        <span class="legend-color" style="background:var(--status-healthy);"></span>
                        <span>Healthy</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background:var(--status-warning);"></span>
                        <span>Warning</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background:var(--status-critical);"></span>
                        <span>Critical</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background:var(--neutral-300);"></span>
                        <span>No Sensor</span>
                    </div>
                </div>
            </div>

            <!-- Zone Grid (4x4, 9 active sensors) -->
            <div id="zone-grid" class="zone-grid">
                <!-- Populated by App.renderZoneGrid() -->
            </div>

            <!-- Selected Zone Details -->
            <div id="zone-details" class="zone-details" style="display:none;">
                <h3 class="font-h3" style="margin-bottom:12px;">Zone <span id="zone-name">--</span></h3>
                <div class="metrics-grid-dense">
                    <div class="metric-cell">
                        <label>VWC</label>
                        <span id="zone-vwc">--%</span>
                    </div>
                    <div class="metric-cell">
                        <label>Potential</label>
                        <span id="zone-psi">--kPa</span>
                    </div>
                    <div class="metric-cell">
                        <label>Avail H2O</label>
                        <span id="zone-aw">--mm</span>
                    </div>
                    <div class="metric-cell">
                        <label>Depletion</label>
                        <span id="zone-depl">--%</span>
                    </div>
                    <div class="metric-cell">
                        <label>Status</label>
                        <span id="zone-status">--</span>
                    </div>
                    <div class="metric-cell">
                        <label>Regime</label>
                        <span id="zone-regime">--</span>
                    </div>
                </div>
                <button class="btn-secondary btn-full" style="margin-top:16px;" onclick="App.clearZoneSelection()">Clear
                    Selection</button>
            </div>

            <div class="action-grid" style="margin-top:24px;">
                <button class="btn-secondary" onclick="App.goToTier(3)">Back to Dashboard</button>
            </div>
        </section>


        <!-- SETTINGS INFO -->
        <section id="settings" class="view-section">
            <div class="view-header">
                <button class="btn-text" onclick="App.goToTier(3)">â€¹ Back</button>
                <h2 class="font-h2">Settings</h2>
            </div>

            <!-- Quick Setup -->
            <div class="settings-group">
                <h3 class="font-h3">Quick Setup</h3>
                <label class="settings-label">Crop Type</label>
                <select class="form-select" id="set-crop">
                    <option value="maize">Maize (Corn)</option>
                    <option value="rice">Rice</option>
                    <option value="wheat">Wheat</option>
                    <option value="veg">Vegetables</option>
                    <option value="custom">Custom</option>
                </select>

                <label class="settings-label" style="margin-top:12px;">Planting Date</label>
                <input type="date" class="form-select" id="set-date">
            </div>

            <!-- General -->
            <div class="settings-group">
                <label class="settings-label">Language</label>
                <select class="form-select" id="set-lang" onchange="App.setLang(this.value)">
                    <option value="en">English</option>
                    <option value="es">EspaÃ±ol</option>
                </select>
            </div>

            <div class="settings-group">
                <label class="settings-label">Temperature Unit</label>
                <div class="toggle-group">
                    <button class="btn-full active" id="btn-c">Â°C</button>
                    <button class="btn-full" id="btn-f">Â°F</button>
                </div>
            </div>

            <!-- Advanced Config -->
            <details>
                <summary style="padding:12px; font-weight:600; color:var(--neutral-600); cursor:pointer;">Advanced
                    Configuration</summary>
                <div style="padding:16px; background:var(--neutral-50); border-radius:8px; margin-top:8px;">
                    <label class="settings-label">Flow Rate (L/hr)</label>
                    <input type="number" class="form-select" id="set-flow" value="1000">

                    <label class="settings-label" style="margin-top:12px;">Farm Area (Hectares)</label>
                    <input type="number" class="form-select" id="set-area" value="2.5">

                    <label class="settings-label" style="margin-top:12px;">Water Cost ($/L)</label>
                    <input type="number" step="0.001" class="form-select" id="set-cost" value="0.05">

                    <hr style="margin:16px 0; border:0; border-top:1px solid #ddd;">

                    <label class="settings-label">Critical Threshold (%)</label>
                    <input type="range" style="width:100%" min="10" max="40" value="30" id="set-crit-slide"
                        oninput="document.getElementById('disp-crit-val').innerText = this.value">
                    <span style="font-size:12px; color:#666;">Value: <span id="disp-crit-val">30</span>%</span>
                </div>
            </details>

            <!-- Live Sensor Data Output -->
            <div class="settings-group" style="margin-top:24px;">
                <label class="settings-label">ðŸ“¡ Live Sensor Data</label>
                <div class="info-box" style="background:#E8F5E9; border:1px solid #A5D6A7;">
                    <div style="display:flex; justify-content:space-between; margin-bottom:12px;">
                        <span style="font-weight:500;">Soil Moisture (Raw ADC)</span>
                        <span id="live-soil-raw" style="font-family:monospace; font-size:18px; color:#2E7D32;">--</span>
                    </div>
                    <div style="display:flex; justify-content:space-between; margin-bottom:12px;">
                        <span style="font-weight:500;">Soil Moisture (VWC)</span>
                        <span id="live-soil-vwc"
                            style="font-family:monospace; font-size:18px; color:#2E7D32;">--%</span>
                    </div>
                    <div style="display:flex; justify-content:space-between; margin-bottom:12px;">
                        <span style="font-weight:500;">Temperature Probe</span>
                        <span id="live-temp" style="font-family:monospace; font-size:18px; color:#1565C0;">--Â°C</span>
                    </div>
                    <div style="display:flex; justify-content:space-between;">
                        <span style="font-weight:500;">Last Updated</span>
                        <span id="live-timestamp" style="font-size:12px; color:#666;">--</span>
                    </div>
                </div>
                <button class="btn-secondary" style="margin-top:8px; width:100%;" onclick="App.refreshSensorData()">ðŸ”„
                    Refresh Now</button>
            </div>

            <div class="settings-group" style="margin-top:24px;">
                <label class="settings-label">Device Info</label>
                <div class="info-box">
                    <p>Serial: AG-2026-X88</p>
                    <p>Firmware: v2.5.0</p>
                    <p>Storage: 45% used</p>
                </div>
            </div>

            <button class="btn-primary btn-full" onclick="App.saveSettings()">Save Configuration</button>
        </section>

    </main>

    <script src="js/physics.js"></script>
    <script src="js/i18n.js"></script>
    <script>
        (function () {
            try {
                const stored = localStorage.getItem('agriscan_user_prefs');
                if (stored) {
                    const config = JSON.parse(stored);
                    if (config.onboarding_complete) return;
                }
                window.location.href = '/onboarding.html';
            } catch (e) {
                console.error('Onboarding check error:', e);
                window.location.href = '/onboarding.html';
            }
        })();
    </script>

    <script src="js/app.js"></script>
</body>

</html>